<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-Modal Medical Data Fusion Diagnostic Assistant</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #f4f7f9;       /* Light grey background */
            --bg-secondary: #ffffff;     /* White for cards */
            --text-primary: #2c3e50;     /* Dark slate for primary text */
            --text-secondary: #5a6a7a;   /* Muted slate for secondary text */
            --accent-blue: #3498db;      /* Professional blue */
            --accent-cyan: #1abc9c;      /* Calming teal/green */
            --accent-magenta: #9b59b6;   /* Professional purple */
            --accent-green: #27ae60;     /* Success green */
            --accent-yellow: #f1c40f;     /* Warning yellow */
            --accent-red: #e74c3c;       /* Danger red */
            --cyan: var(--accent-cyan);
            --blue: var(--accent-blue);
            --magenta: var(--accent-magenta);
            --border-color: #dee2e6;
        }

        body {
            font-family: 'Inter', sans-serif;            
            background-color: var(--bg-primary);
            color: var(--text-primary);
            overflow-x: hidden;
        }

        html {
            scroll-behavior: smooth;
        }
        
        #particles-js {
            display: none; /* Hide particles for a cleaner look */
        }

        /* Glass cards */
        .card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 1rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            transition: all 0.4s ease;
        }
        .card:hover {
            border-color: var(--accent-blue);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
            transform: translateY(-4px);
        }

        /* Tabs */
        .tab-content {
          display: none;
          opacity: 0;
          transition: opacity 0.4s ease-in-out;
        }
        .tab-content.active {
          display: block;
          opacity: 1;
        }

        .tab-button {
            background: var(--bg-secondary);
            color: var(--text-secondary);
            border: 1px solid var(--border-color);
            border-radius: 1rem;
            padding: 0.75rem 1.25rem;
            font-weight: 600;
            transition: all 0.35s ease-in-out;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            width: 100%;
            text-align: center;
        }
        .tab-button:not(.active):hover {
            border-color: var(--accent-blue);
            color: var(--accent-cyan);
            transform: translateY(-2px);
        }
        .tab-button.active {
            background: linear-gradient(90deg, var(--accent-cyan), var(--accent-blue));
            color: #fff;
            border-color: transparent;
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
        }

        /* Organ Visualization */
        .organ {
            fill: rgba(52, 152, 219, 0.4); /* --accent-blue with opacity */
            transition: all 0.3s ease;
            cursor: pointer;
            pointer-events: all; /* allows hover detection */
        }
        .organ:hover {
            fill: rgba(26, 188, 156, 0.7); /* --accent-cyan with opacity */
            stroke: var(--accent-cyan);
        }
        .organ.highlight {
            fill: rgba(231, 76, 60, 0.7); /* --accent-red with opacity */
            stroke: var(--accent-red);
        }

        /* Tooltip */
        #body-map-tooltip {
            position: absolute;
            background: var(--text-primary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 8px 12px;
            color: var(--bg-secondary);
            font-size: 0.9rem;
            opacity: 0;
            transition: opacity 0.2s ease-in-out;
            pointer-events: none;
            z-index: 9999;
            white-space: nowrap;
        }
        #body-map-tooltip.visible {
            opacity: 1;
        }

        @keyframes pulse-organ {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        /* Buttons */
        button {
            transition: all 0.3s ease-in-out;
        }
        #analyze-button {
            background: var(--accent-blue);
            color: white;
        }
        #analyze-button:hover {
            background: #2980b9; /* Darker blue */
            transform: translateY(-2px);
        }
        #reset-button {
            background: #e9ecef;
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
        }
        #reset-button:hover {
            background: #ced4da;
            border-color: #adb5bd;
        }

        /* Header Gradient */
        h1 {
            background: linear-gradient(to right, var(--accent-blue), var(--accent-cyan));
            -webkit-background-clip: text;
            color: transparent;
        }

        /* Chart Styles */
        .bar-bg {
            background-color: #e9ecef;
            border-radius: 0.25rem;
            overflow: hidden;
            height: 1.5rem;
            position: relative;
        }
        .bar {
            height: 100%;
            border-radius: 0.25rem;
            transition: width 1s ease-in-out;
            width: 0%;
        }
        .bar.animate {
            width: var(--bar-width);
        }
        .bar-label {
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }
        
        /* Status Colors */
        .text-status-green { color: var(--accent-green); }
        .text-status-yellow { color: var(--accent-yellow); }
        .text-status-red { color: var(--accent-red); }

        /* Glowing Focus */
        input:focus, button:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.25);
        }

        /* Pulse Animation */
        @keyframes pulseWarning {
            0%, 100% { background-color: rgba(231, 76, 60, 0.1); border-color: rgba(231, 76, 60, 0.4); }
            50% { background-color: rgba(231, 76, 60, 0.2); border-color: rgba(231, 76, 60, 0.8); }
        }
        .pulse-warning {
            animation: pulseWarning 2s infinite;
        }

        /* Sidebar */
        #sidebar {
            transition: all 0.3s ease;
        }
        .sidebar-link {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0.75rem;
            border-radius: 0.75rem;
            background: transparent;
            transition: all 0.3s ease-in-out;
        }
        .sidebar-link:hover, .sidebar-link.active {
            background: rgba(52, 152, 219, 0.1);
            transform: scale(1.05);
        }
        .sidebar-link.active svg {
            stroke: url(#gradActive);
        }

        /* Timeline */
        .timeline {
            position: relative;
            padding-left: 2.5rem;
            border-left: 2px solid var(--border-color);
        }
        .timeline-item {
            position: relative;
            margin-bottom: 2rem;
        }
        .timeline-item:last-child {
            margin-bottom: 0;
        }
        .timeline-dot {
            position: absolute;
            left: -0.5625rem;
            top: 0.25rem;
            width: 1rem;
            height: 1rem;
            border-radius: 50%;
            background-color: var(--accent-blue);
            border: 2px solid var(--bg-primary);
        }

        /* Media Queries */
        @media (min-width: 1024px) {
            #sidebar-nav {
                min-height: 80vh;
            }
        }
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* Fallbacks */
        .card {
            background: var(--bg-secondary); /* Fallback for backdrop-filter */
        }
        .organ {
            mix-blend-mode: multiply; /* Fallback handled in JS if needed */
        }
    </style>
    <!-- Energy Line Connector Styles -->
    <style>
        .energy-line { display: none; } /* Hide for clinical theme */
    </style>
    <style>
        /* Quantum Core Styles */
        #quantum-core-container {
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 400px;
            display: none; /* Hiding quantum core for clinical theme */
        }

        /* New Header */
        .main-header {
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
        }
    </style>
    <!-- Custom Body Map Container Styles -->
    <style>
        #body-map-container {
          position: relative;
          width: 240px;
          margin: 0 auto;
        }
        #body-map-container img {
          display: block;
        }
        #body-map-svg {
          position: absolute;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
        }
    </style>
</head>
<body class="p-4 sm:p-6 lg:p-8">
    <aside id="sidebar" class="fixed top-0 left-0 h-full w-24 flex flex-col items-center justify-between py-8 bg-white border-r border-gray-200 shadow-md z-50">
        <div class="flex flex-col items-center space-y-10">
            <div class="text-2xl font-extrabold tracking-wider" style="color: var(--accent-blue);">M<span style="color: var(--accent-cyan);">D</span></div>
            <a href="#dashboard-section" class="sidebar-link active" title="Dashboard" aria-label="Dashboard">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="url(#grad1)" class="w-7 h-7" aria-hidden="true">
                    <defs><linearGradient id="grad1" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" stop-color="var(--accent-cyan)"/><stop offset="100%" stop-color="var(--accent-blue)"/></linearGradient></defs>
                    <defs><linearGradient id="gradActive" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="var(--accent-blue)"/><stop offset="100%" stop-color="var(--accent-cyan)"/></linearGradient></defs>
                    <path stroke-linecap="round" stroke-linejoin="round" d="M3 12l9-9 9 9M4 10v10a1 1 0 001 1h14a1 1 0 001-1V10" />
                </svg>
            </a>
            <a href="#patient-actions-section" class="sidebar-link" title="Patients" aria-label="Patients">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="url(#grad2)" class="w-7 h-7" aria-hidden="true">
                    <defs><linearGradient id="grad2" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" stop-color="var(--text-secondary)"/><stop offset="100%" stop-color="var(--text-secondary)"/></linearGradient></defs>
                    <path stroke-linecap="round" stroke-linejoin="round" d="M16 14a4 4 0 10-8 0m8 0v2a2 2 0 002 2h2m-4-4h-8m8 0v2a2 2 0 01-2 2h-2" />
                </svg>
            </a>
            <a href="#vitals-section" class="sidebar-link" title="Reports" aria-label="Reports">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="url(#grad3)" class="w-7 h-7" aria-hidden="true">
                    <defs><linearGradient id="grad3" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" stop-color="var(--text-secondary)"/><stop offset="100%" stop-color="var(--text-secondary)"/></linearGradient></defs>
                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 17v-2m3 2v-4m3 4v-6m5 8H4a2 2 0 01-2-2V5a2 2 0 012-2h16a2 2 0 012 2v14z" />
                </svg>
            </a>
            <a href="#" class="sidebar-link" title="Settings" aria-label="Settings">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="url(#grad4)" class="w-7 h-7" aria-hidden="true">
                    <defs><linearGradient id="grad4" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" stop-color="var(--text-secondary)"/><stop offset="100%" stop-color="var(--text-secondary)"/></linearGradient></defs>
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 8.5a3.5 3.5 0 100 7 3.5 3.5 0 000-7zM19.4 15a1.65 1.65 0 01.33 1.82l-1.17 2.03a1.65 1.65 0 01-1.61.83l-2.26-.35a1.65 1.65 0 00-1.5.45l-1.5 1.5a1.65 1.65 0 01-2.33 0l-1.5-1.5a1.65 1.65 0 00-1.5-.45l-2.26.35a1.65 1.65 0 01-1.61-.83L4.27 16.8a1.65 1.65 0 01.33-1.82l1.62-1.4a1.65 1.65 0 00.45-1.5l-.35-2.26a1.65 1.65 0 01.83-1.61L9.18 7.27a1.65 1.65 0 011.82-.33l2.26.35a1.65 1.65 0 001.5-.45l1.4-1.62a1.65 1.65 0 011.82-.33l2.03 1.17a1.65 1.65 0 01.83 1.61l-.35 2.26a1.65 1.65 0 00.45 1.5l1.62 1.4z" />
                </svg>
            </a>
        </div>
        <p class="text-gray-400 text-xs opacity-80">v2.0</p>
    </aside>

    <div id="particles-js"></div>

    <!-- Energy Line Connectors -->
    <div id="energy-lines-container"></div>

    <div class="ml-24 max-w-full">
        <!-- New Header -->
        <header class="main-header sticky top-0 z-40 p-4 flex items-center justify-between mb-8 max-w-full">
            <div class="flex items-center gap-4">
                <div class="text-3xl font-extrabold tracking-wider" style="color: var(--accent-blue);">M<span style="color: var(--accent-cyan);">D</span></div>
                <div>
                    <h1 class="text-2xl font-bold tracking-tight" id="patient-name">Multi-Modal Diagnostic Assistant</h1>
                    <p class="text-sm text-text-secondary" id="patient-id"></p>
                </div>
            </div>
            <div class="flex items-center gap-4">
                <button id="analyze-button" class="py-2 px-6 rounded-lg font-semibold text-white transition-all transform">Run Fusion Analysis</button>
                <button id="reset-button" class="py-2 px-6 rounded-lg font-semibold transition-all transform">Reset</button>
            </div>
        </header>

        <main id="content-area" class="space-y-12 max-w-7xl mx-auto">
            <!-- Dashboard Overview Section -->
            <section id="dashboard-section">
                <!-- Add Patient Details Card -->
                <div id="patient-actions-section" class="card p-6 mb-8 text-center">
                  <h2 class="text-xl font-semibold mb-4" style="color: var(--accent-cyan);">🧾 Add New Patient</h2>
                  <p class="text-text-secondary mb-6">Click the button below to add or manage patient details.</p>
                  <button onclick="window.location.href='add_patient.html'" class="py-3 px-8 rounded-lg font-semibold bg-gradient-to-r from-[var(--accent-cyan)] to-[var(--accent-blue)] text-white shadow-md hover:shadow-lg transition-all transform hover:-translate-y-1" aria-label="Go to Add Patient">
                    ➕ Go to Add Patient
                  </button>
                  <button onclick="window.location.href='patient_details.html'" class="mt-4 py-3 px-8 rounded-lg font-semibold bg-gradient-to-r from-[var(--accent-magenta)] to-[var(--accent-blue)] text-white shadow-md hover:shadow-lg transition-all transform hover:-translate-y-1" aria-label="Go to Patient Directory">
                    📋 View Patient Directory
                  </button>
                </div>

                <!-- Quantum Core and Results -->
                <div id="analysis-section" class="space-y-6">
                    <!-- Analysis results will be displayed here -->
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mt-12">
                    <!-- Left Column: Data Sources -->
                    <div id="left-column" class="lg:col-span-1 space-y-6">
                        <div class="card p-6" id="overview-content">
                            <h2 class="text-xl font-semibold text-text-primary mb-4 border-b border-gray-200 pb-2">Patient Overview</h2>
                            <p class="text-text-secondary">Select a patient from the directory to view details.</p>
                        </div>
                        <div class="card p-6">
                            <h2 class="text-xl font-semibold text-text-primary mb-4 border-b border-gray-200 pb-2">Patient Visualization</h2>
                            <div class="relative flex items-center justify-center">
                              <div id="body-map-container" class="relative">
                                <img src="istockphoto-182043494-612x612.jpg" alt="Human anatomy model" class="opacity-70 w-full max-w-xs mx-auto select-none pointer-events-none" />
                                <svg id="body-map-svg" viewBox="0 0 200 400" xmlns="http://www.w3.org/2000/svg" class="absolute top-0 left-0 w-full h-full pointer-events-none" aria-label="Body map visualization">
                                  <g id="organ-group">
                                    <path id="brain" d="M90 40 C80 20,120 20,110 40 Z" class="organ" data-status="normal" />
                                    <path id="lung-right" d="M85 90 C70 100,65 150,85 190 Z" class="organ" data-status="normal" />
                                    <path id="lung-left" d="M115 90 C130 100,135 150,115 190 Z" class="organ" data-status="normal" />
                                    <path id="heart" d="M95 160 C85 160,90 180,100 200 C110 180,115 160,105 160 Z" class="organ" data-status="normal" />
                                    <path id="liver" d="M100 210 C140 210,145 230,120 250 C100 260,90 240,100 210 Z" class="organ" data-status="normal" />
                                    <path id="stomach" d="M80 210 C60 220,65 250,85 270 C95 260,100 240,80 210 Z" class="organ" data-status="normal" />
                                    <path id="kidney-left" d="M120 270 C130 280,135 300,120 310 C110 300,110 280,120 270 Z" class="organ" data-status="normal" />
                                    <path id="kidney-right" d="M80 270 C70 280,65 300,80 310 C90 300,90 280,80 270 Z" class="organ" data-status="normal" />
                                  </g>
                                </svg>
                              </div>
                            </div>
                            <div id="body-map-tooltip"></div>
                            <p class="w-full text-text-secondary text-sm text-center mt-2">Hover over organs for status. Analysis will highlight areas of interest.</p>
                        </div>

                        <div class="card p-6">
                          <h2 class="text-xl font-semibold text-text-primary mb-4 border-b border-gray-200 pb-2">Medical Data Inputs</h2>

                          <!-- Tabs -->
                          <div class="flex flex-wrap justify-around gap-2 mb-4" id="data-tab-container" role="tablist" data-content-container="#data-tab-content-container">
                            <button class="tab-button active" data-tab="radiology" role="tab" aria-selected="true" aria-controls="radiology">🩻 Radiology</button>
                            <button class="tab-button" data-tab="pathology" role="tab" aria-selected="false" aria-controls="pathology">🧫 Pathology</button>
                            <button class="tab-button" data-tab="genomics" role="tab" aria-selected="false" aria-controls="genomics">🧬 Genomics</button>
                            <button class="tab-button" data-tab="labs" role="tab" aria-selected="false" aria-controls="labs">🧪 Labs</button>
                          </div>

                          <!-- Tab Content -->
                          <div id="data-tab-content-container" class="prose max-w-none prose-p:text-text-secondary">
                            <!-- Pathology -->
                            <div id="pathology" class="tab-content" role="tabpanel" aria-labelledby="pathology-tab">
                              <h3 class="font-semibold text-lg text-text-primary mb-2">Pathology Findings</h3>
                              <p class="text-text-secondary mb-4">Biopsy confirms moderately differentiated HCC, Grade II. Ki-67 index is 15%, suggesting rapid growth.</p>
                              <div class="flex flex-col gap-3">
                                <button class="py-2 px-4 rounded-md bg-gradient-to-r from-[var(--accent-cyan)] to-[var(--accent-blue)] text-white" onclick="window.open('reports/pathology_report.pdf')">📄 View Pathology Report</button>
                              </div>
                            </div>

                            <!-- Genomics -->
                            <div id="genomics" class="tab-content" role="tabpanel" aria-labelledby="genomics-tab">
                              <h3 class="font-semibold text-lg text-text-primary mb-2">Genomic Report</h3>
                              <div class="space-y-2 mt-2">
                                <p class="flex justify-between text-sm"><span>TP53 (p.R249S)</span> <span class="font-bold" style="color: var(--accent-red);">Detected</span></p>
                                <p class="flex justify-between text-sm"><span>CTNNB1</span> <span class="font-bold" style="color: var(--accent-green);">Not Detected</span></p>
                                <p class="flex justify-between text-sm"><span>TERT Promoter</span> <span class="font-bold" style="color: var(--accent-yellow);">Variant</span></p>
                              </div>
                              <div class="mt-4 flex flex-col gap-3">
                                <button class="py-2 px-4 rounded-md bg-gradient-to-r from-[var(--accent-cyan)] to-[var(--accent-blue)] text-white" onclick="window.open('reports/genomic_profile.pdf')">📊 View Genomic Profile</button>
                              </div>
                            </div>

                            <!-- Labs -->
                            <div id="labs" class="tab-content" role="tabpanel" aria-labelledby="labs-tab">
                              <h3 class="font-semibold text-lg text-text-primary mb-2">Lab Reports</h3>
                              <div class="bar-chart-container mt-3 space-y-2">
                                <div class="bar-wrapper">
                                  <span class="bar-label">AFP (ng/mL)</span>
                                  <div class="bar-bg"><div id="afp-bar" class="bar" style="background-color: var(--accent-red);" data-width="90%">550</div></div>
                                </div>
                                <div class="bar-wrapper">
                                  <span class="bar-label">ALT (U/L)</span>
                                  <div class="bar-bg"><div id="alt-bar" class="bar" style="background-color: var(--accent-yellow);" data-width="75%">95</div></div>
                                </div>
                                <div class="bar-wrapper">
                                  <span class="bar-label">Bilirubin</span>
                                  <div class="bar-bg"><div id="bili-bar" class="bar" style="background-color: var(--accent-green);" data-width="50%">1.1</div></div>
                                </div>
                              </div>
                              <div class="mt-4 flex flex-col gap-3">
                                <button class="py-2 px-4 rounded-md bg-gradient-to-r from-[var(--accent-cyan)] to-[var(--accent-blue)] text-white" onclick="window.open('reports/lab_results.pdf')">📄 View Full Lab Report</button>
                              </div>
                            </div>
                          </div>
                        </div>
                    </div>

                    <!-- Right Column: AI Analysis -->
                    <div id="right-column" class="lg:col-span-2 space-y-6">
                        <div class="card p-6" id="findings-content">
                            <h2 class="text-xl font-semibold text-text-primary mb-4 border-b border-gray-200 pb-2">Key Findings</h2>
                            <p class="text-text-secondary">Select a patient to view findings.</p>
                        </div>
                        <div class="card p-6" id="lab-genomics-content">
                            <h2 class="text-xl font-semibold text-text-primary mb-4 border-b border-gray-200 pb-2">Lab & Genomics</h2>
                            <p class="text-text-secondary">Select a patient to view lab and genomic data.</p>
                        </div>
                        <div id="ai-results-container" class="space-y-6">
                            <div class="card p-6 fade-in" style="animation-delay: 0.2s;">
                                <div class="flex flex-wrap gap-2 mb-4 border-b border-gray-200 pb-3" id="results-tab-container" role="tablist" data-content-container="#results-tab-content-container">
                                    <button class="tab-button active" data-tab="diagnosis-summary" role="tab" aria-selected="true" aria-controls="diagnosis-summary">Summary</button>
                                    <button class="tab-button" data-tab="diagnosis" role="tab" aria-selected="false" aria-controls="diagnosis">Diagnosis</button>
                                    <button id="anomaly-tab-button" class="tab-button" data-tab="anomaly" role="tab" aria-selected="false" aria-controls="anomaly">Anomalies</button>
                                    <button class="tab-button" data-tab="prognosis" role="tab" aria-selected="false" aria-controls="prognosis">Prognosis</button>
                                </div>
                                <div id="results-tab-content-container" class="relative">
                                    <div id="diagnosis-summary" class="tab-content active space-y-2 text-text-secondary" role="tabpanel" aria-labelledby="diagnosis-summary-tab">
                                        <p><strong>Primary Finding:</strong> 5.2 cm liver mass (Segment VI)</p>
                                        <p><strong>Pathology:</strong> Moderately differentiated HCC (Grade II)</p>
                                        <p><strong>Growth Rate:</strong> High (Ki-67 index: 15%)</p>
                                        <p><strong>Genetic Markers:</strong> TP53 mutation detected (poor prognosis)</p>
                                    </div>
                                    <div id="diagnosis" class="tab-content space-y-4" role="tabpanel" aria-labelledby="diagnosis-tab">
                                        <div class="p-3 rounded-lg bg-blue-50 border border-blue-200"><p class="font-semibold text-blue-800">1. Hepatocellular Carcinoma (95% Confidence)</p></div>
                                        <div class="p-3 rounded-lg bg-gray-100 border border-gray-200"><p class="font-semibold text-text-secondary">2. Cholangiocarcinoma (4% Confidence)</p></div>
                                    </div>
                                    <div id="anomaly" class="tab-content" role="tabpanel" aria-labelledby="anomaly-tab">
                                        <div id="anomaly-panel" class="p-4 rounded-lg bg-yellow-50 border border-yellow-300" style="color: #b45309;">
                                            <h3 class="font-bold">Potential Inconsistency Detected</h3>
                                            <p class="text-sm mt-1">Pathology reports "moderately differentiated" tumor, but the Ki-67 index of 15% suggests a more rapid proliferation. Clinician review advised.</p>
                                        </div>
                                    </div>
                                    <div id="prognosis" class="tab-content space-y-3 text-text-secondary" role="tabpanel" aria-labelledby="prognosis-tab">
                                        <p>Prognosis is guarded due to the <strong>TP53 mutation</strong>. High Ki-67 index suggests a risk of rapid progression or recurrence post-treatment.</p>
                                        <p class="font-semibold"><strong>Recommendation:</strong> Staging scans and discussion of treatment options.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card p-6" id="diagnoses-content">
                            <h2 class="text-xl font-semibold text-text-primary mb-4 border-b border-gray-200 pb-2">Differential Diagnoses</h2>
                            <p class="text-text-secondary">Select a patient to view diagnoses.</p>
                        </div>
                        <div class="card p-6" id="anomalies-content">
                            <h2 class="text-xl font-semibold text-text-primary mb-4 border-b border-gray-200 pb-2">Data Anomalies</h2>
                            <p class="text-text-secondary">Select a patient to view anomalies.</p>
                        </div>
                        <div class="card p-6" id="treatments-content">
                            <h2 class="text-xl font-semibold text-text-primary mb-4 border-b border-gray-200 pb-2">Treatment Recommendations</h2>
                            <p class="text-text-secondary">Select a patient to view treatment recommendations.</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Patient Vitals Section -->
            <section id="vitals-section">
                <h2 class="text-2xl font-bold mb-8 text-center" style="color: var(--accent-cyan);">💓 Patient Vitals & History</h2>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-12">
                    <!-- Left Column: Vitals & Chart -->
                    <div>
                        <h3 class="text-xl font-semibold mb-4">Current Vitals</h3>
                        <div class="grid grid-cols-2 gap-4 text-center mb-8">
                            <div class="card p-4"><p class="text-text-secondary">❤️ Heart Rate</p><h3 class="text-2xl font-bold" style="color: var(--accent-green)">82 bpm</h3></div>
                            <div class="card p-4"><p class="text-text-secondary">💉 Blood Pressure</p><h3 class="text-2xl font-bold" style="color: var(--accent-green)">130/85</h3></div>
                            <div class="card p-4"><p class="text-text-secondary">🌡️ Temperature</p><h3 class="text-2xl font-bold" style="color: var(--accent-green)">98.4°F</h3></div>
                            <div class="card p-4"><p class="text-text-secondary">🫁 Oxygen</p><h3 class="text-2xl font-bold" style="color: var(--accent-green)">97%</h3></div>
                        </div>
                        <div class="mt-8">
                            <h3 class="text-xl font-semibold text-center mb-4">Liver Function Panel</h3>
                            <canvas id="lab-trend-chart" aria-label="Liver function panel chart"></canvas>
                        </div>
                    </div>

                    <!-- Right Column: Timeline -->
                    <div>
                        <h3 class="text-xl font-semibold mb-4">Medical Timeline</h3>
                        <div class="timeline">
                            <div class="timeline-item"><div class="timeline-dot"></div><p class="font-semibold">Initial Diagnosis: Fatty Liver Disease</p><p class="text-sm text-text-secondary">1 year ago</p></div>
                            <div class="timeline-item"><div class="timeline-dot"></div><p class="font-semibold">Routine Check-up: Elevated AFP levels noted</p><p class="text-sm text-text-secondary">6 months ago</p></div>
                            <div class="timeline-item"><div class="timeline-dot"></div><p class="font-semibold">Abdominal MRI Ordered</p><p class="text-sm text-text-secondary">1 month ago</p></div>
                            <div class="timeline-item"><div class="timeline-dot"></div><p class="font-semibold">Biopsy Confirms HCC</p><p class="text-sm text-text-secondary">2 weeks ago</p></div>
                            <div class="timeline-item"><div class="timeline-dot"></div><p class="font-semibold" style="color: var(--accent-blue);">Current Analysis: Fusion results ready</p><p class="text-sm text-text-secondary">Today</p></div>
                        </div>
                    </div>
                </div>
                <canvas id="vitals-chart" class="mt-8" aria-label="Vitals chart"></canvas>
            </section>
        </main>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
    <script>
        // Organ findings mapping - dynamic
        let organFindings = {};

        // Utility functions
        function updateOrganStatus(organId, status) {
            const organ = document.getElementById(organId);
            if (organ) {
                organ.setAttribute('data-status', status);
                if (status === 'abnormal') {
                    organ.classList.add('highlight');
                } else {
                    organ.classList.remove('highlight');
                }
            }
        }

        function animateBars() {
            const bars = document.querySelectorAll('.bar');
            bars.forEach(bar => {
                const width = bar.getAttribute('data-width');
                bar.style.setProperty('--bar-width', width);
                bar.classList.add('animate');
            });
        }

        // Tab functionality (robust for all tab groups)
        function setupTabs(containerSelector) {
          const container = document.querySelector(containerSelector);
          if (!container) return;

          container.addEventListener('click', e => {
            const button = e.target.closest('.tab-button');
            if (!button) return;

            const tabContainer = button.closest('[role="tablist"]');
            const contentContainerSelector = tabContainer.dataset.contentContainer;
            const contentContainer = document.querySelector(contentContainerSelector);
            if (!tabContainer || !contentContainer) return;

            const tabId = button.dataset.tab;
            const targetPanel = contentContainer.querySelector(`#${tabId}`);
            if (!targetPanel) return;

            // Reset buttons
            tabContainer.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            contentContainer.querySelectorAll('.tab-content').forEach(panel => panel.classList.remove('active'));

            // Activate clicked tab and its panel
            button.classList.add('active');
            targetPanel.classList.add('active');
          });
        }

        // Tooltip functionality
        function setupTooltip() {
            const tooltip = document.getElementById('body-map-tooltip');
            const organs = document.querySelectorAll('.organ');
            if (!tooltip) return;

            organs.forEach(organ => {
                organ.addEventListener('mousemove', e => {
                    const rect = e.target.getBoundingClientRect();
                    const status = e.target.getAttribute('data-status') || 'normal';
                    const organName = e.target.id.replace(/-/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
                    const statusClass = status === 'abnormal' ? 'text-status-red' : 'text-status-green';
                    tooltip.innerHTML = `<strong>Organ:</strong> ${organName}<br><strong>Status:</strong> <span class="${statusClass}">${status.charAt(0).toUpperCase() + status.slice(1)}</span>`;
                    tooltip.style.left = (e.clientX + 10) + 'px';
                    tooltip.style.top = (e.clientY + 10) + 'px';
                    tooltip.classList.add('visible');
                });
                organ.addEventListener('mouseout', () => tooltip.classList.remove('visible'));
            });
        }

        // Analysis functionality
        function runAnalysis() {
            // Disable buttons
            document.getElementById('analyze-button').disabled = true;

            // Simulate analysis
            setTimeout(() => {
                document.getElementById('analyze-button').disabled = false;

                // Update organ statuses based on findings
                Object.keys(organFindings).forEach(organId => {
                    updateOrganStatus(organId, organFindings[organId].status);
                });

                // Animate bars
                animateBars();

                // Trigger anomaly pulsing
                const anomalyPanel = document.getElementById('anomaly-panel');
                const anomalyTabButton = document.getElementById('anomaly-tab-button');
                if (anomalyPanel) anomalyPanel.classList.add('pulse-warning');
                if (anomalyTabButton) anomalyTabButton.classList.add('pulse-warning');
            }, 1000);
        }

        // Reset functionality
        function resetAnalysis() {
            // Reset organ highlights
            document.querySelectorAll('.organ').forEach(organ => {
                organ.classList.remove('highlight');
                organ.setAttribute('data-status', 'normal');
            });

            // Reset bars
            document.querySelectorAll('.bar').forEach(bar => {
                bar.classList.remove('animate');
                bar.style.width = '0%';
            });

            // Reset pulsing
            const anomalyPanel = document.getElementById('anomaly-panel');
            const anomalyTabButton = document.getElementById('anomaly-tab-button');
            if (anomalyPanel) anomalyPanel.classList.remove('pulse-warning');
            if (anomalyTabButton) anomalyTabButton.classList.remove('pulse-warning');
        }

        // Initialize charts
        function initCharts() {
            // Lab trend chart
            const labCtx = document.getElementById('lab-trend-chart');
            if (labCtx) {
                new Chart(labCtx, {
                    type: 'line',
                    data: {
                        labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                        datasets: [
                            { label: 'AFP (ng/mL)', data: [120, 220, 310, 400, 520, 550], borderColor: 'var(--accent-red)', tension: 0.3 },
                            { label: 'ALT (U/L)', data: [70, 72, 80, 82, 90, 95], borderColor: 'var(--accent-yellow)', tension: 0.3 },
                            { label: 'Bilirubin', data: [1.0, 1.1, 1.2, 1.0, 1.1, 1.1], borderColor: 'var(--accent-green)', tension: 0.3 },
                        ]
                    },
                    options: {
                        plugins: { legend: { labels: { color: 'var(--text-secondary)' } } },
                        scales: {
                            x: { ticks: { color: 'var(--text-secondary)' }, grid: { color: 'var(--border-color)' } },
                            y: { ticks: { color: 'var(--text-secondary)' }, grid: { color: 'var(--border-color)' } }
                        }
                    }
                });
            }

            // Vitals chart
            const vitalsCtx = document.getElementById('vitals-chart');
            if (vitalsCtx) {
                const vitalsChart = new Chart(vitalsCtx, {
                    type: 'line',
                    data: {
                        labels: ['1', '2', '3', '4', '5', '6'],
                        datasets: [{
                            label: 'Heart Rate',
                            borderColor: 'var(--accent-cyan)',
                            data: [80, 82, 83, 84, 83, 82],
                            tension: 0.4
                        }, {
                            label: 'Oxygen',
                            borderColor: 'var(--accent-blue)',
                            data: [96, 97, 98, 97, 96, 97],
                            tension: 0.4
                        }]
                    },
                    options: {
                        plugins: {
                            legend: {
                                labels: { color: 'var(--text-secondary)' }
                            }
                        },
                        scales: {
                            x: {
                                ticks: {
                                    color: 'var(--text-secondary)'
                                }
                            },
                            y: {
                                ticks: { color: 'var(--text-secondary)' }
                            }
                        }
                    }
                });
                setInterval(() => {
                    vitalsChart.data.labels.push('');
                    vitalsChart.data.datasets.forEach(ds => ds.data.push(ds.data[ds.data.length - 1] + (Math.random() - 0.5) * 2));
                    if (vitalsChart.data.labels.length > 12) {
                        vitalsChart.data.labels.shift();
                        vitalsChart.data.datasets.forEach(ds => ds.data.shift());
                    }
                    vitalsChart.update();
                }, 3000);
            }
        }

        // Energy Line Connectors
        function drawEnergyLines() {
            const container = document.getElementById('energy-lines-container');
            if (!container) return;
            container.innerHTML = ''; // Clear existing lines

            const sidebar = document.getElementById('sidebar');
            const leftCol = document.getElementById('left-column');
            const rightCol = document.getElementById('right-column');

            if (!sidebar || !leftCol || !rightCol) return;

            const elements = [sidebar, leftCol, rightCol];
            const points = elements.map(el => {
                const rect = el.getBoundingClientRect();
                return { x: rect.left + rect.width / 2, y: rect.top + rect.height / 2 };
            });

            function createLine(p1, p2) {
                const length = Math.sqrt((p2.x - p1.x) ** 2 + (p2.y - p1.y) ** 2);
                const angle = Math.atan2(p2.y - p1.y, p2.x - p1.x) * 180 / Math.PI;
                const line = document.createElement('div');
                line.className = 'energy-line';
                line.style.width = `${length}px`;
                line.style.height = '2px';
                line.style.left = `${p1.x}px`;
                line.style.top = `${p1.y}px`;
                line.style.transformOrigin = '0 0';
                line.style.transform = `rotate(${angle}deg)`;
                container.appendChild(line);
            }

            createLine(points[0], points[1]);
            createLine(points[1], points[2]);
        }

        // Initialize Particles.js
        function initParticles() {
            if (document.getElementById('particles-js')) {
                // Particles are disabled in this theme
            }
        }

        // Sidebar active link observer
        function setupSidebarObserver() {
            const sidebarLinks = document.querySelectorAll('.sidebar-link');
            const sections = document.querySelectorAll('section[id], div[id="patient-actions-section"]');

            const observer = new IntersectionObserver(entries => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const id = entry.target.getAttribute('id');
                        const activeLink = document.querySelector(`.sidebar-link[href="#${id}"]`);

                        sidebarLinks.forEach(link => link.classList.remove('active'));
                        if (activeLink) {
                            activeLink.classList.add('active');
                        }
                    }
                });
            }, { rootMargin: "-50% 0px -50% 0px" }); // Trigger when section is in the middle of the viewport

            sections.forEach(section => {
                observer.observe(section);
            });
        }


        // DOM Content Loaded
        document.addEventListener('DOMContentLoaded', function() {
            // Load patient data from URL
            const urlParams = new URLSearchParams(window.location.search);
            const patientId = urlParams.get('patientId');
            if (patientId) {
                loadPatientData(patientId);
            }

            // Setup tabs
            setupTabs('#data-tab-container');
            setupTabs('#results-tab-container');

            // Setup tooltip
            setupTooltip();

            // Setup sidebar observer
            setupSidebarObserver();

            // Setup analysis buttons
            const analyzeButtons = document.querySelectorAll('#analyze-button');
            analyzeButtons.forEach(button => {
                button.addEventListener('click', runAnalysis);
            });

            // Setup reset button
            const resetButton = document.getElementById('reset-button');
            if (resetButton) {
                resetButton.addEventListener('click', resetAnalysis);
            }

            // Initialize charts
            initCharts();

            // Initialize particles
            initParticles();

            // Draw energy lines and redraw on resize
            drawEnergyLines();
            window.addEventListener('resize', drawEnergyLines);

            // Error handling for missing elements
            const requiredElements = ['body-map-tooltip', 'organ-group'];
            requiredElements.forEach(id => {
                if (!document.getElementById(id)) {
                    console.warn(`Required element with id '${id}' not found`);
                }
            });
        });

        // Load patient data
        function loadPatientData(patientId) {
            // Mock data from index.html
            const mockPatients = [
                {
                    id: 'PID-84321', name: 'Eleanor Vance', dob: '1965-08-12', lastVisit: '2025-10-12', status: 'Diagnosis Pending', statusColor: 'yellow',
                    data: {
                        overview: { age: 60, gender: 'Female', bloodType: 'O-', allergies: 'Penicillin', symptoms: 'Headaches, blurred vision, cognitive decline.', summary: 'Patient presents with symptoms suggestive of a central nervous system malignancy. Multi-modal data analysis is underway to determine the specific diagnosis and optimal treatment path.' },
                        organs: [
                          { name: 'Heart', status: 'Healthy' },
                          { name: 'Lungs', status: 'At Risk' },
                          { name: 'Liver', status: 'Failed' },
                          { name: 'Kidneys', status: 'Healthy' },
                          { name: 'Brain', status: 'Healthy' }
                        ],
                        labGenomics: {
                            keyMutation: 'IDH1 R132H wild-type',
                            methylation: 'MGMT promoter methylated',
                            tumorMarkers: [ { name: 'CEA', value: 5.2, normalRange: '< 5.0' }, { name: 'CA-125', value: 30, normalRange: '< 35' } ]
                        },
                        findings: [
                            { source: 'Pathology Report', finding: 'Tumor Grade', value: 'IV (High-grade)' },
                            { source: 'Pathology Report', finding: 'Cellularity', value: 'Hypercellular with marked pleomorphism' },
                            { source: 'MRI Report', finding: 'Tumor Location', value: 'Right frontal lobe' },
                            { source: 'MRI Report', finding: 'Tumor Size', value: '4.5 cm x 3.8 cm' },
                        ],
                        diagnoses: [
                            { name: 'Glioblastoma, IDH-wildtype', score: 92, evidence: 'High-grade astrocytoma features, IDH wild-type status, ring-enhancing lesion on MRI.' },
                            { name: 'Anaplastic Astrocytoma', score: 78, evidence: 'Malignant astrocytic tumor, but typically has a better prognosis than glioblastoma.' },
                            { name: 'Primary CNS Lymphoma', score: 65, evidence: 'Can mimic glioblastoma on imaging, but genomic markers are inconsistent.' },
                        ],
                        anomalies: [ { severity: 'Medium', message: 'Discrepancy in tumor size between initial radiology report (4.1cm) and NLP extraction (4.5cm). Manual review suggested.' } ]
                    }
                },
                {
                    id: 'PID-19875', name: 'Marcus Thorne', dob: '1978-04-22', lastVisit: '2025-09-28', status: 'Stable', statusColor: 'green',
                    data: {
                        overview: { age: 47, gender: 'Male', bloodType: 'A+', allergies: 'None', symptoms: 'Persistent cough, weight loss.', summary: 'Patient diagnosed with Lung Adenocarcinoma, Stage IIB. Post-resection and adjuvant chemotherapy, patient shows stable condition with no signs of recurrence in recent follow-ups.' },
                        organs: [
                          { name: 'Heart', status: 'Healthy' },
                          { name: 'Lungs', status: 'Healthy' },
                          { name: 'Liver', status: 'Healthy' },
                          { name: 'Kidneys', status: 'Healthy' },
                          { name: 'Brain', status: 'Healthy' }
                        ],
                        labGenomics: {
                            keyMutation: 'EGFR exon 19 deletion',
                            methylation: 'Not applicable',
                            tumorMarkers: [ { name: 'CEA', value: 2.1, normalRange: '< 5.0' } ]
                        },
                        findings: [
                            { source: 'Pathology Report', finding: 'Histology', value: 'Adenocarcinoma, acinar predominant' },
                            { source: 'CT Scan Report', finding: 'Primary Tumor Status', value: 'Resected' },
                        ],
                        diagnoses: [ { name: 'Lung Adenocarcinoma (Post-Treatment)', score: 98, evidence: 'Confirmed EGFR mutation, successful resection, and normal tumor markers.' } ],
                        anomalies: [ { severity: 'Low', message: 'No significant data anomalies detected. All data sources are consistent.' } ]
                    }
                },
                 {
                    id: 'PID-55409', name: 'Isabella Rossi', dob: '1990-11-05', lastVisit: '2025-10-02', status: 'Further Tests Required', statusColor: 'red',
                    data: {
                        overview: { age: 35, gender: 'Female', bloodType: 'B-', allergies: 'Sulfa drugs', symptoms: 'Abdominal pain, bloating.', summary: 'Initial ultrasound revealed an ovarian mass. Pathology and genomic data are conflicting, requiring further immunohistochemistry tests to resolve diagnostic uncertainty.' },
                        organs: [
                          { name: 'Heart', status: 'At Risk' },
                          { name: 'Lungs', status: 'At Risk' },
                          { name: 'Liver', status: 'At Risk' },
                          { name: 'Kidneys', status: 'Failed' },
                          { name: 'Brain', status: 'Healthy' }
                        ],
                        labGenomics: {
                            keyMutation: 'BRAF V600E positive',
                            methylation: 'MLH1 promoter hypermethylation detected',
                            tumorMarkers: [ { name: 'CA-125', value: 250, normalRange: '< 35' } ]
                        },
                        findings: [ { source: 'Pathology Report', finding: 'Tumor Type', value: 'Ovarian serous tumor' } ],
                        diagnoses: [
                            { name: 'Serous Borderline Tumor', score: 85, evidence: 'Pathology suggests borderline malignancy, but BRAF mutation is more common in low-grade serous carcinoma.' },
                            { name: 'Low-Grade Serous Carcinoma', score: 82, evidence: 'BRAF mutation is a strong indicator, but pathology is not definitively invasive.' },
                        ],
                        anomalies: [ { severity: 'High', message: 'Significant conflict: Pathology suggests a borderline (non-invasive) tumor, while the presence of a BRAF V600E mutation strongly indicates a low-grade carcinoma (invasive). This is a critical diagnostic conflict.' } ],
                        treatments: [
                            { name: 'MEK Inhibitor Therapy (e.g., Trametinib)', rationale: 'Recommended for BRAF V600E-mutated low-grade serous carcinoma to target the MAPK pathway.', type: 'Targeted Therapy' },
                            { name: 'Hormonal Therapy', rationale: 'May be considered as an alternative or adjuvant treatment.', type: 'Adjuvant' },
                            { name: 'Clinical Trial NCT03268502', rationale: 'Investigating combination of BRAF and MEK inhibitors in this patient population.', type: 'Clinical Trial' }
                        ]
                    }
                }
            ];

            const patient = mockPatients.find(p => p.id === patientId);
            if (patient) {
                // Update page title and header
                document.title = `Patient Details - ${patient.name}`;
                document.getElementById('patient-name').textContent = patient.name;
                document.getElementById('patient-id').textContent = `ID: ${patient.id} | DOB: ${patient.dob}`;

                // Populate overview
                const overview = patient.data.overview;
                document.getElementById('overview-content').innerHTML = `
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div><strong>Age:</strong> ${overview.age}</div>
                        <div><strong>Gender:</strong> ${overview.gender}</div>
                        <div><strong>Blood Type:</strong> ${overview.bloodType}</div>
                        <div><strong>Allergies:</strong> ${overview.allergies}</div>
                    </div>
                    <div><strong>Symptoms:</strong> ${overview.symptoms}</div>
                    <div class="mt-4"><strong>Summary:</strong> ${overview.summary}</div>
                `;

                // Populate organs
                organFindings = {};
                patient.data.organs.forEach(organ => {
                    organFindings[organ.name.toLowerCase()] = { status: organ.status.toLowerCase() };
                });

                // Populate findings
                const findingsHtml = patient.data.findings.map(f => `
                    <div class="flex justify-between items-center p-3 bg-slate-50 rounded-lg border border-slate-200">
                        <div>
                            <span class="font-semibold text-slate-800">${f.finding}</span>
                            <span class="text-xs text-slate-500 ml-2">(${f.source})</span>
                        </div>
                        <span class="text-teal-600 font-medium">${f.value}</span>
                    </div>
                `).join('');
                document.getElementById('findings-content').innerHTML = findingsHtml;

                // Populate lab & genomics
                const labGenomics = patient.data.labGenomics;
                const markerHtml = labGenomics.tumorMarkers.map(marker => {
                    const isElevated = parseFloat(marker.value) > parseFloat(marker.normalRange.replace('< ',''));
                    return `
                        <div class="flex items-center justify-between p-3 rounded-lg ${isElevated ? 'bg-red-50' : 'bg-green-50'}">
                           <div class="font-semibold text-sm ${isElevated ? 'text-red-800' : 'text-green-800'}">${marker.name}</div>
                           <div class="text-right">
                               <div class="font-bold ${isElevated ? 'text-red-700' : 'text-green-700'}">${marker.value}</div>
                               <div class="text-xs text-slate-500">Normal: ${marker.normalRange}</div>
                           </div>
                        </div>
                    `;
                }).join('');
                document.getElementById('lab-genomics-content').innerHTML = `
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="card p-6">
                            <h3 class="font-bold text-lg mb-4">Genomic Variants</h3>
                            <div class="space-y-3">
                                <div class="flex justify-between text-sm"><span class="text-slate-600">Key Mutation:</span> <strong class="text-right">${labGenomics.keyMutation}</strong></div>
                                <div class="flex justify-between text-sm"><span class="text-slate-600">Methylation Status:</span> <strong class="text-right">${labGenomics.methylation}</strong></div>
                            </div>
                        </div>
                        <div class="card p-6">
                            <h3 class="font-bold text-lg mb-4">Tumor Markers</h3>
                            <div class="space-y-3">
                                ${markerHtml}
                            </div>
                        </div>
                    </div>
                `;

                // Populate diagnoses
                const diagnosesHtml = patient.data.diagnoses.map(d => `
                    <div>
                        <div class="flex justify-between items-center mb-2">
                            <h4 class="font-semibold text-base text-teal-700">${d.name}</h4>
                            <span class="font-bold text-lg text-slate-700">${d.score}%</span>
                        </div>
                        <div class="w-full bg-slate-200 rounded-full h-2.5">
                            <div class="progress-bar h-2.5 rounded-full" style="width: ${d.score}%"></div>
                        </div>
                        <div class="mt-3 p-3 bg-teal-50 border-l-4 border-teal-400 rounded-r-lg">
                            <p class="text-sm text-slate-700"><strong class="font-semibold">Supporting Evidence:</strong> ${d.evidence}</p>
                        </div>
                    </div>
                `).join('');
                document.getElementById('diagnoses-content').innerHTML = diagnosesHtml;

                // Populate anomalies
                const colors = {
                    High: { bg: 'bg-red-50', border: 'border-red-400', text: 'text-red-800', icon: '<path d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>' },
                    Medium: { bg: 'bg-amber-50', border: 'border-amber-400', text: 'text-amber-800', icon: '<path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>' },
                    Low: { bg: 'bg-green-50', border: 'border-green-400', text: 'text-green-800', icon: '<path d="M5 13l4 4L19 7"/>' }
                };
                const anomaliesHtml = patient.data.anomalies.map(a => `
                    <div class="p-4 rounded-lg flex items-start ${colors[a.severity].bg} border-l-4 ${colors[a.severity].border}">
                        <svg class="h-6 w-6 mr-3 mt-1 flex-shrink-0 ${colors[a.severity].text}" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">${colors[a.severity].icon}</svg>
                        <div>
                            <h4 class="font-semibold ${colors[a.severity].text}">${a.severity} Severity Anomaly</h4>
                            <p class="text-sm text-slate-700 mt-1">${a.message}</p>
                        </div>
                    </div>
                `).join('');
                document.getElementById('anomalies-content').innerHTML = anomaliesHtml;

                // Set initial organ statuses
                Object.keys(organFindings).forEach(organId => {
                    updateOrganStatus(organId, organFindings[organId].status);
                });
            }

            // Populate treatments
            if (patient.data.treatments) {
                const treatmentTypes = {
                    'Targeted Therapy': { bg: 'bg-blue-50', border: 'border-blue-400', text: 'text-blue-800' },
                    'Adjuvant': { bg: 'bg-slate-50', border: 'border-slate-400', text: 'text-slate-800' },
                    'Clinical Trial': { bg: 'bg-purple-50', border: 'border-purple-400', text: 'text-purple-800' }
                };
                const treatmentsHtml = patient.data.treatments.map(t => `
                    <div class="p-4 rounded-lg ${treatmentTypes[t.type]?.bg || 'bg-gray-50'} border-l-4 ${treatmentTypes[t.type]?.border || 'border-gray-400'}">
                        <h4 class="font-semibold ${treatmentTypes[t.type]?.text || 'text-gray-800'}">${t.name} <span class="text-xs font-medium bg-white px-2 py-1 rounded-full">${t.type}</span></h4>
                        <p class="text-sm text-slate-700 mt-1">${t.rationale}</p>
                    </div>
                `).join('<div class="my-4"></div>');
                document.getElementById('treatments-content').innerHTML = `<div class="space-y-4">${treatmentsHtml}</div>`;
            }
        }
